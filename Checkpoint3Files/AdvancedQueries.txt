SELECT U.FirstName, U.LastName, COUNT(R.EquipmentSerialNumber) 
FROM Users AS U, UserRents AS R 
WHERE U.UserID = R.UserID  
GROUP BY U.UserID, U.FirstName, U.LastName;

SELECT U.FirstName, U.LastName, U.Email 
FROM Users AS U, UserRents AS R,
    (SELECT AVG(Count) AS AverageUser FROM
        (SELECT COUNT(R.EquipmentSerialNumber) AS Count
         FROM UserRents AS R
         GROUP BY UserID)) AS A
WHERE U.UserID = R.UserID
GROUP BY U.UserID, U.FirstName, U.LastName, U.Email
HAVING COUNT(R.EquipmentSerialNumber) > A.AverageUser;

SELECT E.SerialNumber, E.Model, E.Manufacturer, E.Year, COUNT(R.EquipmentSerialNumber) AS TimesRented 
FROM Equipment AS E, Rentals AS R 
WHERE E.SerialNumber = R.EquipmentSerialNumber 
GROUP BY E.SerialNumber, E.Model, E.Manufacturer, E.Year 
ORDER BY TimesRented DESC; 

SELECT d.SerialNumber, COUNT(r.RentalNumber) as NumDeliveries, SUM(ud.Distance) TotalDistance 
FROM Drones as d JOIN Equipment as e ON d.OrderNumber = e.OrderNumber 
	JOIN Rentals as r ON e.SerialNumber = r.EquipmentSerialNumber 
	JOIN UserDistance as ud ON r.UserID = ud.UserID 
GROUP BY d.SerialNumber 
ORDER BY NumDeliveries DESC, TotalDistance DESC; 

SELECT Manufacturer
FROM (
    SELECT E.Manufacturer,
           COUNT(*) AS rentalCount
    FROM Rental R
    JOIN Equipment E
      ON R.SerialNumber = E.SerialNumber
    GROUP BY E.Manufacturer
) AS MCounts
WHERE rentalCount = (
    SELECT MAX(rentalCount)
    FROM (
        SELECT E.Manufacturer,
               COUNT(*) AS rentalCount
        FROM Rental R
        JOIN Equipment E
          ON R.SerialNumber = E.SerialNumber
        GROUP BY E.Manufacturer
    ) AS InnerCounts
);

SELECT e.SerialNumber, e.Model, SUM(julianday(r.Due - R.Checkout) AS TotalRentDays, 
	COUNT(r.RentalNumber) AS TimesRented 
	FROM Equipment AS e JOIN Rentals as r ON e.SerialNumber = r.EquipmentSerialNumber 
	GROUP BY e.SerialNumber, e.Model 
	ORDER BY TotalRentDays DESC; 

SELECT DISTINCT u.UserID, u.FirstName, up.Phone 
	FROM Users AS u JOIN UserPhone as up ON u.UserID = up.UserID 
	JOIN Rentals as r ON u.UserID = r.UserID 
	WHERE r.EquipmentSerialNumber = (SELECT EquipmentSerialNumber 
					FROM Rentals 
					GROUP BY UserID 
					ORDER BY COUNT(*) DESC 
					LIMIT 1); 
    
SELECT DISTNCT e.Manufacturer 
	FROM Equipment as e JOIN Rentals as r ON e.SerialNumber = r.EquipmentSerialNumber 
	WHERE r.UserID IN ( SELECT UserID 
			FROM(SELECT UserID, COUNT(*) as RentalCount 
				FROM Rentals 
				GROUP BY UserID) as UserCount 
			WHERE RentalCount > (SELECT AVG(RentalCount) 
						FROM (SELECT COUNT(*) as RentalCount 
							FROM Rentals 
							GROUP BY UserID))); 

